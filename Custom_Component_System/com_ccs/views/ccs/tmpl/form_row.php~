<?php
// Author: Igor Kekeljevic, 2012.


// No direct access
defined('_JEXEC') or die('Restricted access');

JHTML::_('behavior.formvalidation');// Form Validation Libraries
JHTML::_('behavior.calendar');// Callendar Libraries
JHTML::_('behavior.tooltip');// Tooltip Libraries
JHTML::_('behavior.modal');// Modal Libriries (SqueezeBox)

$document = JFactory::getDocument();
$calendar_js='
    // Calendar support
    window.addEvent("domready", function() {Calendar.setup({
            inputField     :    "entrydate",     // id of the input field
            ifFormat       :    "%Y-%m-%d",      // format of the input field
            button         :    "entrydate_img",  // trigger for the calendar (button ID)
            align          :    "Bl",           // alignment (defaults to "Bl" = Bottom Left, 
    // "Tl" = Top Left, "Br" = Bottom Right, "Bl" = Botton Left)
            singleClick    :    true
        });});
';
$validation_js='
    // Validation support
    Joomla.submitbutton = function(task){
    if(task=="cancel"){
        Joomla.submitform(task);
    }else{
        var f = document.adminForm;
        if (document.formvalidator.isValid(f)) {
            Joomla.submitform(task);
        }else{
				var answer = confirm("'.JText::_( "COM_SPORTORG_TABLE_FIELDS_ERROR").'");
				if (answer){
					Joomla.submitform(task);
				}
        }
    }
    return false;
    }
';
$tooltip_js='
    // Tooltip support
    window.addEvent("domready", function(){ 
       var JTooltips = new Tips($$(".hasTip"), 
       { maxTitleChars: 50, fixed: false}); 
    });
';


$document->addScriptDeclaration($validation_js);

?>

<form enctype="multipart/form-data" action="index.php" method="post" name="adminForm" class="form-validate" >

<fieldset class="adminform" class="form-validate">
<legend><?php echo JText::_( 'COM_SPORTORG_TABLE_FIELDS_FORM');?></legend>
<ul class="adminformlist">


<?php
$i=0;
echo '<input type="hidden" name="id" value="'.$this->row["id"].'" />';
foreach ($this->showFields as $field_alias => $field_type)// Loop through Show Fields
{
    if($field_type != "int unsigned")// Skip add Form Field for DB row identifier
    {    

    echo '<li>';
    
    // Create Form Field Label
    echo '<label id="jform_enabled-lbl" for="jform_enabled">';
    echo JText::_( strtoupper($field_alias));
    echo '</label>';
    
	$field_value="";
	if($this->row[$field_alias]!="")// Update Value
	{
		$field_value=$this->row[$field_alias];
	}

	$specFieldRow=NULL;// Predifined for Special Field Check
	foreach($this->specialFields as $specialField)// Loop through array of Special Fields
	{
		if($specialField["field"]==$field_alias)// Check if Field is Special Field
		{
			$specFieldRow=$specialField;
		}
	}

	if(!empty($specFieldRow))// Apply action for special and standard fields
	{
		
		//		
		// SPECIAL FIELD TYPE SYNTAX
		// FIELD_ALIAS=SPECIAL_FIELD_TYPE=SPECIAL_FIELD_PARAMS
		//
		// dropbox=value1,label1|value2,label2|value3,label3
		// checkbox=value1,label1|value2,label2|value3,label3
		// button=onClickValue|label
		// modal=width|height|urlOfView
		//
		
		switch($specFieldRow["type"])// Render Special Field by defined type
		{
			case "droplist":
				echo '<select name="'.$field_alias.'" class="requeired editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_DROPLIST').'">';			
				$params_array = explode("|",$specFieldRow["params"]);
				foreach($params_array as $params)// Add Dropbox item for any param founded
				{
					$value__label = explode(",",$params);
					$selected=NULL;					
					if($value__label[0]==$field_value)// Add Selected Value
					{
						$selected=' selected="selected"';
					}
	            echo '<option value="'.$value__label[0].'"'.$selected.'>'.JText::_($value__label[1]).'</option>';
				}
				 echo '</select>';
			break;
			case "checkbox":
				$params_array = explode("|",$specFieldRow["params"]);
				foreach($params_array as $params)// Add Dropbox item for any param founded
				{
					$value__label = explode(",",$params);
					$checked=NULL;					
					if($value__label[0]==$field_value)// Add Selected Value
					{
						$checked='  checked="checked"';
					}
	            echo '<input type="radio" name="'.$field_alias.'" value="'.$value__label[0].'"'.$checked.'/><span class="inlineValue">'.JText::_($value__label[1]).'&nbsp;&nbsp;&nbsp;</span>';
				}
			break;
			case "button":
				$javascript__label = explode("|",$specFieldRow["params"]);
				echo '<input type="button" onclick="'.$javascript__label[0].'" value="'.JText::_($javascript__label[1]).'" />'; 
			break;
			case "modal":
				$width__height__url = explode("|",$specFieldRow["params"]);
				echo '<input type="text" id="'.$field_alias.'" name="'.$field_alias.'" value="'.$field_value.'" class="required validate-text editlinktip" />';
				echo '<input type="button" value="'.JText::_('COM_SPORTORT_SELECT').'" onclick="SqueezeBox.fromElement(this, {handler:\'iframe\', size: {x: '.$width__height__url[0].', y: '.$width__height__url[1].'}, url:\''.urlencode($width__height__url[2]).'\'})">'; 
			break;
		}
	}else{
		switch($field_type)// Render Standard Field by DB field type
		{           
	     case "text":
		    echo '<textarea name="'.$field_alias.'" rows="6">'.$field_value.'</textarea>';
	     break;      
	     case "mediumtext":
	         $editor =& JFactory::getEditor();
		    echo $editor->display($field_alias, $field_value, '550', '200', '60', '10', false);
	     break; 
	     case "int":
	             echo '<input type="text" name="'.$field_alias.'" value="'.$field_value.'" class="required validate-numeric editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_INT').'" />';
	     break;
	     case "varchar":
	             echo '<input type="text" name="'.$field_alias.'" value="'.$field_value.'" class="required validate-text editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_VARCHAR').'" />';
	     break;  
	     case "date":
	         $document->addScriptDeclaration($calendar_js);
	         echo '<input id="entrydate" name="'.$field_alias.'" type="text" class="required validate-text" value="'.$field_value.'" />';
	         echo '<img class="calendar editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_DATE').'" src="components/com_sportorg/assets/icons/icon-16-calendar.png" alt="calendar" id="entrydate_img" / >';
	     break;
	     case "tinyint":
	             echo '<select name="'.$field_alias.'" class="requeired editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_TINYINT').'">';
          	     $selected_f=NULL;
                 $selected_t=NULL;
	             if($field_value=="1")
	             {
	                 $selected_t=' selected="selected"';
	             }else{
	                 $selected_f=' selected="selected"'; 
	             }
	             echo '<option value="0"'.$selected_f.'>'.JText::_('COM_SPORTORG_FALSE').'</option>';
	             echo '<option value="1"'.$selected_t.'>'.JText::_('COM_SPORTORG_TRUE').'</option>';
	             echo '</select>';
	     break;  
	     default:
	         echo '<input type="text" name="'.$field_alias.'" value="'.$field_value.'" class="required validate-text editlinktip hasTip" title="'.JText::_('COM_SPORTORG_TOOLTIPS_VARCHAR').'" />';
	    }
	}
    
    echo '</li>';
    
    }
    
    $i++;
}
?>

</ul>
</fieldset>

<input type="hidden" name="option" value="com_sportorg" />
<input type="hidden" name="task" value="<?php echo $this->task; ?>" />
<input type="hidden" name="layout" value="<?php echo $this->task; ?>" />
<input type="hidden" name="controller" value="sportorg" />
<input type="hidden" name="alias" value="<?php echo $this->alias; ?>" />
</form>
