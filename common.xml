<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : common.xml
    Created on : January 7, 2014, 1:25 AM
    Author     : Anakin
    Description:
        Purpose of the document follows.
-->

<project>
    <property environment="env"/>
    <property name="source" value="D:\wamp\www\joomla321"/>
    <property name="release" value="D:\webdev\php\projects"/>
    <property name="builddir" value="C:\TEMP\com_admirorgallery"/>
    <property name="verbose" value="false"/>
    <!-- Get timestamp -->
    <tstamp>
        <format property="NOW" pattern="yyyyMMdd"/>
    </tstamp>
    <!-- Get revision number -->
    <loadfile property="dist.revision" srcFile="./.svn/entries" failonerror="false">
        <filterchain>
            <headfilter lines="1" skip="3"/>
            <deletecharacters chars="\n"/>
        </filterchain>
    </loadfile>

    <condition property="version" value="${NOW}_r${dist.revision}" else="${NOW}">
        <isset property="dist.revision"/>
    </condition>
    <!-- Build targets -->
    <target name="_clean">
        <delete dir="${builddir}/${NAME}" verbose="${verbose}"/>
    </target>

    <target name="_sync">
        <sync todir="${NAME}" includeemptydirs="true">
            <fileset dir="${builddir}/${NAME}"/>
            <preserveintarget>
                <include name="**/.svn/**"/>
            </preserveintarget>
        </sync>
    </target>
    <target name="_package">
        <zip destfile="${release}/${NAME}_${version}.zip" basedir="" excludes=".svn,nbproject/**,com_admirorgallery_ant.xml,common.xml"/>
    </target>
    <target name="buildcomponent" depends="_clean">
        <mkdir dir="${builddir}/${NAME}/admin"/>
        <mkdir dir="${builddir}/${NAME}/admin/language/en-GB"/>
        <mkdir dir="${builddir}/${NAME}/admin/language/de-DE"/>
        <mkdir dir="${builddir}/${NAME}/admirorbutton"/>
        <mkdir dir="${builddir}/${NAME}/admirorbutton/language/en-GB"/>
        <mkdir dir="${builddir}/${NAME}/admirorgallery"/>
        <mkdir dir="${builddir}/${NAME}/admirorgallery/language/en-GB"/>
        <mkdir dir="${builddir}/${NAME}/site"/>
        <mkdir dir="${builddir}/${NAME}/site/language/en-GB"/>
        <mkdir dir="${builddir}/${NAME}/site/language/de-DE"/>
        
        <copy todir="${builddir}/${NAME}/admin" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/administrator/components/${NAME}"/>
        </copy>
        <copy todir="${builddir}/${NAME}/admin/language/en-GB" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/administrator/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/en-GB.${NAME}*.ini" />
            </fileset>
        </copy>
        <copy todir="${builddir}/${NAME}/admin/language/de-DE" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/administrator/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/de-DE.${NAME}*.ini" />
            </fileset>
        </copy>
        <copy todir="${builddir}/${NAME}/admirorbutton" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/plugins/editors-xtd/admirorbutton"/>
        </copy>
        <copy todir="${builddir}/${NAME}/admirorbutton/language/en-GB" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/administrator/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/en-GB.plg_editors-xtd_admirorbutton*.ini" />
            </fileset>
        </copy>
        <copy todir="${builddir}/${NAME}/admirorgallery" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/plugins/content/admirorgallery"/>
        </copy>
        <copy todir="${builddir}/${NAME}/admirorgallery/language/en-GB" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/administrator/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/en-GB.plg_content_admirorgallery*.ini" />
            </fileset>
        </copy>

        <copy todir="${builddir}/${NAME}/site" overwrite="true" verbose="${verbose}">
            <fileset dir="${source}/components/${NAME}"/>
        </copy>
        <copy todir="${builddir}/${NAME}/site/language/en-GB" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/en-GB.${NAME}*.ini" />
            </fileset>
        </copy>
        <copy todir="${builddir}/${NAME}/site/language/de-DE" overwrite="true" verbose="${verbose}" flatten="true">
            <fileset dir="${source}/language">
                <exclude name="overrides/*"/>
                <exclude name="pdf_fonts/*"/>
                <include name="**/de-DE.${NAME}*.ini" />
            </fileset>
        </copy>
        <move file="${builddir}/${NAME}/admin/${NAME}.xml" todir="${builddir}/" verbose="${verbose}"/>
        <move file="${builddir}/${NAME}/admin/admirorgallery.scriptfile.php" todir="${builddir}/" verbose="${verbose}"/>
    </target>
</project>
